// backend/prisma/schema.prisma
// EXAMPLE ADDITIONS: Database models for different file types

// ============================================================================
// EXISTING MODELS (Keep these)
// ============================================================================

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  name        String
  password    String
  accessLevel Int      @default(3)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  payslips    Payslip[]
  contracts   Contract[] // Add this
  documents   Document[] // Add this
}

model Payslip {
  id          String   @id @default(cuid())
  employeeId  String
  year        Int
  month       Int
  fileName    String
  fileUrl     String   // R2 key: payslips/YYYY/MM/emp_payslip.pdf
  fileSize    Int
  grossSalary Float?
  netSalary   Float?
  notes       String?
  viewCount   Int      @default(0)
  viewedAt    DateTime?
  uploadedById String
  uploadedAt  DateTime @default(now())

  employee    User     @relation(fields: [employeeId], references: [id])
  uploadedBy  User     @relation("UploadedPayslips", fields: [uploadedById], references: [id])

  @@unique([employeeId, year, month])
  @@index([employeeId])
  @@index([year, month])
}

// ============================================================================
// NEW MODELS: Add these for contracts, documents, etc.
// ============================================================================

// Contract Model
model Contract {
  id           String   @id @default(cuid())
  employeeId   String
  contractType String   // 'employment', 'vendor', 'nda', 'freelance', etc.
  contractDate DateTime
  expiryDate   DateTime?
  fileName     String
  fileUrl      String   // R2 key: contracts/{type}/emp_contract_YYYY-MM-DD.pdf
  fileSize     Int
  notes        String?
  status       String   @default("active") // 'active', 'expired', 'terminated'
  uploadedById String
  uploadedAt   DateTime @default(now())
  updatedAt    DateTime @updatedAt

  employee     User     @relation(fields: [employeeId], references: [id])
  uploadedBy   User     @relation("UploadedContracts", fields: [uploadedById], references: [id])

  @@index([employeeId])
  @@index([contractType])
  @@index([status])
}

// Employee Document Model (ID cards, certificates, tax forms, etc.)
model Document {
  id          String   @id @default(cuid())
  employeeId  String
  category    String   // 'id-cards', 'certificates', 'tax-forms', 'insurance', etc.
  docType     String   // 'national-id', 'passport', 'degree', 'w2', etc.
  fileName    String
  fileUrl     String   // R2 key: documents/{category}/emp_{docType}_timestamp.pdf
  fileSize    Int
  issueDate   DateTime?
  expiryDate  DateTime?
  notes       String?
  uploadedById String
  uploadedAt  DateTime @default(now())
  updatedAt   DateTime @updatedAt

  employee    User     @relation(fields: [employeeId], references: [id])
  uploadedBy  User     @relation("UploadedDocuments", fields: [uploadedById], references: [id])

  @@index([employeeId])
  @@index([category])
  @@index([docType])
}

// Company Files Model (policies, forms, handbooks, etc.)
model CompanyFile {
  id          String   @id @default(cuid())
  category    String   // 'policies', 'forms', 'handbooks', 'announcements', etc.
  title       String
  description String?
  fileName    String
  fileUrl     String   // R2 key: company/{category}/filename_timestamp.pdf
  fileSize    Int
  version     String?
  isActive    Boolean  @default(true)
  uploadedById String
  uploadedAt  DateTime @default(now())
  updatedAt   DateTime @updatedAt

  uploadedBy  User     @relation("UploadedCompanyFiles", fields: [uploadedById], references: [id])

  @@index([category])
  @@index([isActive])
}

// Attachment Model (for announcements, memos, etc.)
model Attachment {
  id          String   @id @default(cuid())
  relatedType String   // 'announcement', 'memo', 'task', etc.
  relatedId   String?  // ID of related entity
  fileName    String
  fileUrl     String   // R2 key: attachments/{type}/filename_timestamp.ext
  fileSize    Int
  mimeType    String
  uploadedById String
  uploadedAt  DateTime @default(now())

  uploadedBy  User     @relation("UploadedAttachments", fields: [uploadedById], references: [id])

  @@index([relatedType, relatedId])
}

// ============================================================================
// MIGRATION COMMANDS
// ============================================================================

// After adding these models:
// 1. npx prisma format
// 2. npx prisma migrate dev --name add_file_models
// 3. npx prisma generate
